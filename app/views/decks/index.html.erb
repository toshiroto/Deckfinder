<div class="container">
  <div class="row d-flex justify-content-between">
    <ul class="nav tabs-underlined" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="active tab-underlined" id="player-tab" data-toggle="tab" href="#player" role="tab" aria-controls="player" aria-selected="true">Player</a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="tab-underlined" id="owner-tab" data-toggle="tab" href="#owner" role="tab" aria-controls="owner" aria-selected="false">Owner</a>
      </li>
    </ul>
    <%= simple_form_for :query, url: decks_path, method: :get do |f| %>
      <div class="search-form-control form-group">
        <input class="form-control string required" type="text" name="query" id="search_query" />
        <button name="button" type="submit" class="btn btn-search">
          <i class="fas fa-search"></i> Search
        </button>
      </div>
    <% end %>
  </div>
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade py-3 show active" id="player" role="tabpanel" aria-labelledby="player-tab">
      <%# Creating a condition where a user does not see his/her own deck in a player list %>
      <% @decks.each do |deck| %>
        <% if deck.user != current_user%>
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <p style="font-size: 24px" class="card-title"><strong><%= link_to deck.name, deck_path(deck) %></strong></p>
              <%= render 'sample_image'%>
            </div>
            <%# <p class="card-title"><strong><%= link_to deck.name, deck_path(deck) %>
            <p class="card-text" style="font-size: 18px"><em>$<%= deck.price %> per day</em></p>
            <p class="card-text"><%= deck.desc %></p>
            <p class="card-text" style="font-size: 18px"><small>Total Rental Requests: <strong><%= Rental.count{|rental| rental.pending? && current_user != rental.user } %></strong></small></p>

              <%# if deck.rentals.find {|rental| rental.deck == deck }.status.capitalize == "Pending"%>
                <%# <p class="card-text" style="font-size: 18px"><small>Total Rental Requests: <strong> %>
              <%# i = 0 %>
              <%# deck.rentals.each do |rental| %>
                <%# if rental.status = "pending"%>
                  <%# i += 1%>
                <%# end %>
              <%# end %>
              <%#= i %>
            <%# </strong></small></p> %>
            <%# else%>
              <%# %>
              <%# end %>


            <% condition_arr = current_user.rentals.find {|rental| rental.deck == deck } %>
            <% if condition_arr == nil %>
              <%= link_to "Request Rental",  new_deck_rental_path(deck), class:"btn btn-request" %>
            <% else %>
              <% condition = current_user.rentals.find {|rental| rental.deck == deck }.status.capitalize %>
              <% case condition%>
              <% when "Pending"%>
              <%= link_to "#{current_user.rentals.find {|rental| rental.deck == deck }.status.capitalize}",  rentals_path, class:"btn btn-pending" %>
              <% when "Approved"%>
              <%= link_to "#{current_user.rentals.find {|rental| rental.deck == deck }.status.capitalize}",  rentals_path, class:"btn btn-approved" %>
              <% else "Rejected"%>
              <%= link_to "#{current_user.rentals.find {|rental| rental.deck == deck }.status.capitalize}",  rentals_path, class:"btn btn-dark" %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="tab-pane fade py-3" id="owner" role="tabpanel" aria-labelledby="owner-tab">
      <div class="card-body">
        <%= link_to "New Deck", new_deck_path, class:"btn btn-request" %>
        <div>
        </div>
      </div>
      <% @owned_decks.each do |deck| %>
        <div class="card-body">
          <p class="card-title"><strong><%= link_to deck.name, deck_path(deck) %></strong></p>
          <p class="card-text">$<%= deck.price %></p>
          <p class="card-text"><%= deck.desc %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>
